"use strict";angular.module("pjTts.directives",["pjTts.factories"]).directive("tts",["$log","TTSAudio",function(a,b){return{restrict:"E",template:'<div class="pj-tts" ng-click="speak()"><button class="btn btn-primary"><span ng-if="tts.$pending" class="glyphicon glyphicon glyphicon-refresh"></span><span ng-if="!tts.$pending" class="glyphicon glyphicon-volume-down"></span></button></div>',scope:{text:"=",lang:"="},link:function(a){a.tts=!1,a.speak=function(){a.tts||(a.tts=new b),a.tts.speak({text:a.text,lang:a.lang})},a.$on("$destroy",function(){a.tts&&a.tts.clear()})}}}]),angular.module("pjTts.factories",[]).factory("TTSAudio",["$log","$timeout","$interval","$window","AudioLoaderService","$rootScope","TTS_EVENTS",function(a,b,c,d,e,f,g){return function(){var h=angular.isFunction(d.Audio),i=this,j=!1,k=!1,l=null,m=h?new d.Audio:!1;i.$pending=!1,i.$hasError=!1,i.speak=function(d){function n(){b(function(){m.play(),k||(k=c(function(){i.$pending=j&&!m.paused,i.$pending||(f.$broadcast(g.SUCCESS),i.clean())},50))},1)}function o(a){m.src=a.data.path,n(),j=!0,i.$hasError=!1}function p(a){i.$hasError=!0,f.$broadcast(g.FAILED)}function q(){return d.text+"#"+d.lang}return h?void(j&&l===q()?n():(i.clean(),f.$broadcast(g.PENDING),i.$pending=!0,l=q(),e.load(d).then(o,p))):void a.warn("HTML5 audio is not supported.")},i.clean=function(){k&&(c.cancel(k),k=!1)}}}]).service("AudioLoaderService",["$http","TTSConfig",function(a,b){this.load=function(c){return a({url:b.url,method:"GET",params:c})}}]),angular.module("pjTts",["pjTts.directives","pjTts.factories"]).value("TTSConfig",{url:"http://drilapp.dev/api/v1/tts"}).constant("TTS_EVENTS",{PENDING:"tts-pending",SUCCESS:"tts-success",FAILED:"tts-failed"});