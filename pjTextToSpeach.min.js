"use strict";angular.module("pjTts.directives",["pjTts.factories"]).directive("tts",["$log","TTSAudio",function(a,b){return{restrict:"E",template:'<div class="pj-tts" ng-click="speak()"><button class="btn btn-primary"><span ng-if="tts.$pending" class="glyphicon glyphicon glyphicon-refresh"></span><span ng-if="!tts.$pending" class="glyphicon glyphicon-volume-down"></span></button></div>',scope:{text:"=",lang:"="},link:function(a){a.tts=!1,a.speak=function(){a.tts||(a.tts=new b),a.tts.speak(a.text,a.lang,(new Date).getTime())},a.$on("$destroy",function(){a.tts&&a.tts.clear()})}}}]),angular.module("pjTts.factories",[]).factory("TTSAudio",["$log","$timeout","$interval","$window","AudioLoaderService",function(a,b,c,d,e){return function(){var f=angular.isFunction(d.Audio),g=this,h=!1,i=!1,j=null,k=f?new d.Audio:!1;g.$pending=!1,g.$hasError=!1,g.speak=function(d,l,m){function n(){b(function(){k.play(),i||(i=c(function(){g.$pending=h&&!k.paused},100))},1)}function o(a){k.src=a.data.path,n(),h=!0,g.$hasError=!1}function p(a){g.$hasError=!0}return f?void(h&&j===d+""+l?n():(g.clean(),g.$pending=!0,j=d+""+l,e.load({text:d,lang:l,id:m}).then(o,p))):void a.warn("HTML5 audio is not supported.")},g.clean=function(){i&&(c.cancel(i),i=!1)}}}]).service("AudioLoaderService",["$log","$http","TTSConfig",function(a,b,c){this.load=function(d){return a.info("loading audio file path: "+c.url),b({url:c.url,method:"GET",params:d})}}]),angular.module("pjTts",["pjTts.directives","pjTts.factories"]).value("TTSConfig",{url:"http://drilapp.dev/api/v1/tts"});